import {
  DataType,
  type ModelConfig,
  type SanitizedModelSchema,
  type SanitizedModelShape,
  SchemaType,
  type Simplify,
} from '@genseki/react'

/**
 * Creates a sanitized model with the given shape and config.
 * @param {TShape} shape The shape of the model
 * @param {TConfig} config The configuration of the model
 * @returns {SanitizedModel<TShape>} A sanitized model containing the shape and config
 */
function model<const TShape extends SanitizedModelShape, const TConfig extends ModelConfig>(
  shape: TShape,
  config: TConfig
): SanitizedModelSchema<TShape, TConfig> {
  return { config, shape }
}

export const UserModel = model(
  {
    columns: {
      id: {
        schema: SchemaType.COLUMN,
        name: 'id',
        isId: true,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.STRING,
      },
      email: {
        schema: SchemaType.COLUMN,
        name: 'email',
        isId: false,
        isList: false,
        isUnique: true,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      name: {
        schema: SchemaType.COLUMN,
        name: 'name',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: false,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      createdAt: {
        schema: SchemaType.COLUMN,
        name: 'createdAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
      updatedAt: {
        schema: SchemaType.COLUMN,
        name: 'updatedAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
    },
    relations: {
      get posts() {
        return {
          schema: SchemaType.RELATION,
          name: 'posts',
          isId: false,
          isList: true,
          isUnique: false,
          isReadOnly: false,
          isRequired: true,
          hasDefaultValue: false,
          relationName: 'PostToUser',
          referencedModel: 'Post',
          relationToFields: [],
          relationFromFields: [],
          relationDataTypes: [],
        }
      },
      comments: {
        schema: SchemaType.RELATION,
        name: 'comments',
        isId: false,
        isList: true,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'CommentToUser',
        referencedModel: 'Comment',
        relationToFields: [],
        relationFromFields: [],
        relationDataTypes: [],
      },
      profiles: {
        schema: SchemaType.RELATION,
        name: 'profiles',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: false,
        hasDefaultValue: false,
        relationName: 'ProfileToUser',
        referencedModel: 'Profile',
        relationToFields: [],
        relationFromFields: [],
        relationDataTypes: [],
      },
    },
    primaryFields: ['id'],
    uniqueFields: [['id'], ['email']],
  },
  {
    name: 'UserModel',
    dbModelName: 'User',
    prismaModelName: 'user',
  }
)

export type UserModel = Simplify<typeof UserModel>

export const ProfileModel = model(
  {
    columns: {
      id: {
        schema: SchemaType.COLUMN,
        name: 'id',
        isId: true,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.STRING,
      },
      bio: {
        schema: SchemaType.COLUMN,
        name: 'bio',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: false,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      userId: {
        schema: SchemaType.COLUMN,
        name: 'userId',
        isId: false,
        isList: false,
        isUnique: true,
        isReadOnly: true,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      createdAt: {
        schema: SchemaType.COLUMN,
        name: 'createdAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
      updatedAt: {
        schema: SchemaType.COLUMN,
        name: 'updatedAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
    },
    relations: {
      user: {
        schema: SchemaType.RELATION,
        name: 'user',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'ProfileToUser',
        referencedModel: 'User',
        relationToFields: ['id'],
        relationFromFields: ['userId'],
        relationDataTypes: [DataType.STRING],
      },
    },
    primaryFields: ['id'],
    uniqueFields: [['id'], ['userId']],
  },
  {
    name: 'ProfileModel',
    dbModelName: 'Profile',
    prismaModelName: 'profile',
  }
)

export type ProfileModel = Simplify<typeof ProfileModel>

export const PostModel = model(
  {
    columns: {
      id: {
        schema: SchemaType.COLUMN,
        name: 'id',
        isId: true,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.STRING,
      },
      title: {
        schema: SchemaType.COLUMN,
        name: 'title',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      content: {
        schema: SchemaType.COLUMN,
        name: 'content',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: false,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      published: {
        schema: SchemaType.COLUMN,
        name: 'published',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.BOOLEAN,
      },
      authorId: {
        schema: SchemaType.COLUMN,
        name: 'authorId',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: true,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      createdAt: {
        schema: SchemaType.COLUMN,
        name: 'createdAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
      updatedAt: {
        schema: SchemaType.COLUMN,
        name: 'updatedAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
    },
    relations: {
      author: {
        schema: SchemaType.RELATION,
        name: 'author',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'PostToUser',
        referencedModel: 'User',
        relationToFields: ['id'],
        relationFromFields: ['authorId'],
        relationDataTypes: [DataType.STRING],
      },
      comments: {
        schema: SchemaType.RELATION,
        name: 'comments',
        isId: false,
        isList: true,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'CommentToPost',
        referencedModel: 'Comment',
        relationToFields: [],
        relationFromFields: [],
        relationDataTypes: [],
      },
    },
    primaryFields: ['id'],
    uniqueFields: [['id']],
  },
  {
    name: 'PostModel',
    dbModelName: 'Post',
    prismaModelName: 'post',
  }
)

export type PostModel = Simplify<typeof PostModel>

export const CommentModel = model(
  {
    columns: {
      id: {
        schema: SchemaType.COLUMN,
        name: 'id',
        isId: true,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.STRING,
      },
      content: {
        schema: SchemaType.COLUMN,
        name: 'content',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      postId: {
        schema: SchemaType.COLUMN,
        name: 'postId',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: true,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      authorId: {
        schema: SchemaType.COLUMN,
        name: 'authorId',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: true,
        isRequired: true,
        hasDefaultValue: false,
        dataType: DataType.STRING,
      },
      createdAt: {
        schema: SchemaType.COLUMN,
        name: 'createdAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
      updatedAt: {
        schema: SchemaType.COLUMN,
        name: 'updatedAt',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: true,
        dataType: DataType.DATETIME,
      },
    },
    relations: {
      post: {
        schema: SchemaType.RELATION,
        name: 'post',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'CommentToPost',
        referencedModel: 'Post',
        relationToFields: ['id'],
        relationFromFields: ['postId'],
        relationDataTypes: [DataType.STRING],
      },
      author: {
        schema: SchemaType.RELATION,
        name: 'author',
        isId: false,
        isList: false,
        isUnique: false,
        isReadOnly: false,
        isRequired: true,
        hasDefaultValue: false,
        relationName: 'CommentToUser',
        referencedModel: 'User',
        relationToFields: ['id'],
        relationFromFields: ['authorId'],
        relationDataTypes: [DataType.STRING],
      },
    },
    primaryFields: ['id'],
    uniqueFields: [['id']],
  },
  {
    name: 'CommentModel',
    dbModelName: 'Comment',
    prismaModelName: 'comment',
  }
)

export type CommentModel = Simplify<typeof CommentModel>

export const SanitizedFullModelSchemas = {
  user: UserModel,
  profile: ProfileModel,
  post: PostModel,
  comment: CommentModel,
}

export type SanitizedFullModelSchemas = Simplify<typeof SanitizedFullModelSchemas>
